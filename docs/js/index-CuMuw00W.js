import{d as w,o as y,a as C,e as t,I as D,z as f,J as l,l as F,r as P,K as ae,L as ne,m as O,q as L,M as oe,s as se,c as ie,b as K,G as b,H as j,C as U,D as q,k as Z,N as J,O as ce,F as re,P as de}from"./@vue-3w-l4P98.js";import{I as le,B as N,P as me,R as W}from"./@arco-design-vOPDLr3Z.js";import{l as I}from"./leaflet-C5JMGX-n.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./dayjs-CZnAS8i4.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))c(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const p of o.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&c(p)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();const ue={class:"base-panel"},pe={class:"base-panel-header"},ge={class:"base-panel-header-title"},ve={key:0,class:"base-panel-header-tip"},fe={style:{"margin-left":"2px"}},ye={key:0,class:"base-panel-filter"},_e={style:{display:"flex","grid-gap":"10px"}},he={class:"base-panel-body"},be={class:"base-panel-wrap"},$e=w({__name:"BasePanel",props:{title:{},tip:{}},setup(i){return(e,a)=>(y(),C("div",ue,[t("div",pe,[t("div",null,[t("span",ge,D(e.title),1),e.tip?(y(),C("span",ve,[f(l(le)),t("span",fe,D(e.tip),1)])):F("",!0)])]),e.$slots.filter?(y(),C("div",ye,[P(e.$slots,"filter",{},void 0,!0),t("div",_e,[P(e.$slots,"extra",{},void 0,!0)])])):F("",!0),t("div",he,[t("div",be,[P(e.$slots,"body",{},void 0,!0)])])]))}}),x=(i,e)=>{const a=i.__vccOpts||i;for(const[c,n]of e)a[c]=n;return a},H=x($e,[["__scopeId","data-v-e9d23c43"]]);function Ce(i){return new Promise((e,a)=>{const c=new Image;c.onload=()=>e({width:c.width,height:c.height}),c.src=i})}function ke(i,e){const a=w({render(){return ne(i,e)}}),c=f(a);return ae(c,document.createElement("div")),c.el}function u(i){return`./${i}`}function we(i){const{devices:e,deviceSorts:a,currentDevices:c,currentDeviceSort:n}=Se(),o=O([{label:"场景1",value:"场景1",image:".//images/scenes/1.png",devices:[{name:"空气加湿器",code:"b64d86a19dc7",image:".//images/devices/1.png",category:"其他",position:{lat:-63.51433865701932,lng:231}},{name:"电吹风",code:"ad77e73280d3",image:".//images/devices/9.png",category:"其他",position:{lat:-118.01213270978559,lng:320.5}},{name:"智能闹钟",code:"c3e3f3a6213d",image:".//images/devices/13.png",category:"其他",position:{lat:-84.01323568340246,lng:76}},{name:"滚筒洗衣机",code:"f792dd8f989f",image:".//images/devices/6.png",category:"其他",position:{lat:-202.96227830230302,lng:317}},{name:"电风扇",code:"cc805117dc5d",image:".//images/devices/16.png",category:"其他",position:{lat:-163.97551398570548,lng:149.5}},{name:"投影仪",code:"b1c9ff86591a",image:".//images/devices/8.png",category:"娱乐",position:{lat:-81.51257389923234,lng:155.5}},{name:"按摩椅",code:"1ccefe2be178",image:".//images/devices/7.png",category:"娱乐",position:{lat:-70.02338304067766,lng:213}},{name:"智能音箱",code:"w5ea0618149d",image:".//images/devices/12.png",category:"娱乐",position:{lat:-103.0112503308921,lng:220}},{name:"云台摄像头",code:"cf3be09a9e47",image:".//images/devices/4.png",category:"安全",position:{lat:-98.01169152033884,lng:270.5}},{name:"智能门锁",code:"ccc5e7d2c7da",image:".//images/devices/14.png",category:"安全",position:{lat:-47.50727962587135,lng:196.5}},{name:"冰柜",code:"e801626f006b",image:".//images/devices/17.png",category:"温控",position:{lat:-129.00022059472337,lng:92}}]},{label:"场景2",value:"场景2",image:".//images/scenes/2.png",devices:[]}]),p=L(o[0].value),r=oe(),$=L(!1),R=()=>{r.value=I.map(i.planeContainer.value,{minZoom:1,maxZoom:4,crs:I.CRS.Simple,attributionControl:!1})},A=()=>{const d=i.deviceContainer.value,g=i.planeContainer.value;d.ondragstart=s=>{const m=s.target.getAttribute("data-code");s.dataTransfer.setData("data-code",m)},g.ondragover=s=>s.preventDefault(),g.ondrop=s=>{const v=s.dataTransfer.getData("data-code"),m=e.find(M=>M.code===v);o.find(M=>M.value===p.value).devices.push(m);const S=r.value.getBounds(),h=S.getNorth(),Q=S.getWest(),V=r.value.getZoom(),z=r.value.project([h,Q],V),T=g.getBoundingClientRect(),ee=s.clientX-T.left,te=s.clientY-T.top,G=r.value.unproject([ee+z.x,te+z.y],V);m.position=G,k(m,G)}},B=async()=>{$.value=!0,r.value.eachLayer(h=>{r.value.removeLayer(h)});const d=o.find(h=>h.value===p.value),{width:g,height:s}=await Ce(d.image),v=r.value.getMinZoom()+1,m=r.value.unproject([0,s],v),E=r.value.unproject([g,0],v),S=new I.LatLngBounds(m,E);I.imageOverlay(d.image,S).addTo(r.value),r.value.fitBounds(S),$.value=!1,d.devices.forEach(h=>{h.position&&k(h,h.position)})},_=d=>{const g=o.find(s=>s.value===p.value);g.devices=g.devices.filter(s=>s.code!==d),r.value.eachLayer(s=>{s instanceof I.Marker&&s.options.title===d&&r.value.removeLayer(s)}),Array.from(document.querySelectorAll(".arco-trigger-popup")).map(s=>{document.body.removeChild(s)})},k=(d,g)=>{const s=ke(ze,{data:d,onRemove:_}),v=I.divIcon({html:s,iconSize:[2,2],iconAnchor:[1,1]}),m=I.marker(g,{icon:v,draggable:!0});m.options.title=d.code,m.on("mouseover",()=>{m.getElement().style.zIndex="1000"}),m.on("mouseout",()=>{m.getElement().style.zIndex="256"}),m.on("moveend",()=>{d.position=m.getLatLng()}),m.addTo(r.value)},X=()=>{const d=JSON.stringify(o,null,2),g=new Blob([d],{type:"application/json"}),s=URL.createObjectURL(g),v=document.createElement("a");v.href=s,v.download="scenes.json",v.click()},Y=()=>{const d=document.createElement("input");d.type="file",d.accept=".json",d.onchange=async()=>{const g=d.files[0],s=new FileReader;s.onload=v=>{const m=v.target.result,E=JSON.parse(m);o.length=0,E.forEach((S,h)=>{o[h]=S}),p.value=o[0].value,B()},s.readAsText(g)},d.click()};return se(()=>{R(),A(),B()}),{devices:e,deviceSorts:a,scenes:o,currentDevices:c,currentDeviceSort:n,currentScene:p,onSceneChange:B,onRemoveDevice:_,onExportScenes:X,onImportScenes:Y}}function Se(){const i=O([{name:"空气加湿器",code:"b64d86a19dc7",image:u("/images/devices/1.png"),category:"其他"},{name:"轻薄笔记本",code:"k52b8717d009",image:u("/images/devices/1.png"),category:"娱乐"},{name:"智慧吸顶灯",code:"c8317a6a586f",image:u("/images/devices/3.png"),category:"其他"},{name:"云台摄像头",code:"cf3be09a9e47",image:u("/images/devices/4.png"),category:"安全"},{name:"空气净化器",code:"qaa2d9c17cda",image:u("/images/devices/5.png"),category:"温控"},{name:"滚筒洗衣机",code:"f792dd8f989f",image:u("/images/devices/6.png"),category:"其他"},{name:"按摩椅",code:"1ccefe2be178",image:u("/images/devices/7.png"),category:"娱乐"},{name:"投影仪",code:"b1c9ff86591a",image:u("/images/devices/8.png"),category:"娱乐"},{name:"电吹风",code:"ad77e73280d3",image:u("/images/devices/9.png"),category:"其他"},{name:"温度传感器",code:"d500b354a7fd",image:u("/images/devices/10.png"),category:"温控"},{name:"扫地机器人",code:"f32638d152b8",image:u("/images/devices/11.png"),category:"安全"},{name:"智能音箱",code:"w5ea0618149d",image:u("/images/devices/12.png"),category:"娱乐"},{name:"智能闹钟",code:"c3e3f3a6213d",image:u("/images/devices/13.png"),category:"其他"},{name:"智能门锁",code:"ccc5e7d2c7da",image:u("/images/devices/14.png"),category:"安全"},{name:"打印机",code:"eeb5772561a6",image:u("/images/devices/15.png"),category:"其他"},{name:"电风扇",code:"cc805117dc5d",image:u("/images/devices/16.png"),category:"其他"},{name:"冰柜",code:"e801626f006b",image:u("/images/devices/17.png"),category:"温控"}]),e=O(["其他","娱乐","安全","温控"]),a=L(e[0]),c=ie(()=>i.filter(n=>n.category===a.value));return{devices:i,deviceSorts:e,currentDevices:c,currentDeviceSort:a}}const Ie={class:"base-device-item",draggable:"true"},De={class:"base-device-item-name"},Le={class:"base-device-item-code"},xe=w({__name:"BaseDeviceItem",props:{data:{}},setup(i){return(e,a)=>(y(),C("div",Ie,[t("div",{class:"base-device-item-image",style:K({backgroundImage:`url(${e.data.image})`})},null,4),t("div",null,[t("div",De,D(e.data.name),1),t("div",Le,D(e.data.code),1)])]))}}),Be=x(xe,[["__scopeId","data-v-a0a69678"]]),Ee={class:"base-device-detail"},Pe=["src"],Re={class:"base-device-detail-name"},Ae={class:"base-device-detail-items"},Me={class:"detail-item"},Oe={class:"item-value"},je=w({__name:"BaseDeviceDetail",props:{data:{}},setup(i){return(e,a)=>(y(),C("div",Ee,[t("img",{class:"base-device-detail-banner",src:e.data.image,alt:""},null,8,Pe),t("div",Re,D(e.data.name),1),t("div",Ae,[a[1]||(a[1]=t("div",{class:"detail-item"},[t("div",{class:"item-label"},"品牌"),t("div",{class:"item-value"},"小米公司")],-1)),t("div",Me,[a[0]||(a[0]=t("div",{class:"item-label"},"分类",-1)),t("div",Oe,D(e.data.category),1)]),a[2]||(a[2]=t("div",{class:"detail-item"},[t("div",{class:"item-label"},"状态"),t("div",{class:"item-value"},"在线")],-1))])]))}}),Ne=x(je,[["__scopeId","data-v-99d13025"]]),Ve={class:"base-device-marker"},ze=w({__name:"BaseDeviceMarker",props:{data:{},onRemove:{type:Function}},setup(i){return(e,a)=>(y(),C("div",Ve,[f(l(me),{position:"rt",trigger:"contextMenu"},{content:b(()=>[f(Ne,{data:e.data},null,8,["data"]),f(l(N),{size:"mini",long:"",type:"primary",status:"danger",onClick:a[0]||(a[0]=()=>e.onRemove(e.data.code))},{default:b(()=>a[1]||(a[1]=[j(" 移除 ")])),_:1})]),default:b(()=>[t("div",{class:"base-device-marker-image",style:K({backgroundImage:`url(${e.data.image})`})},null,4)]),_:1}),a[2]||(a[2]=t("div",{class:"base-device-marker-dot"},null,-1))]))}}),Te={},Ge={class:"layout-brand"};function Fe(i,e){return y(),C("div",Ge,e[0]||(e[0]=[t("div",{class:"layout-brand-logo"},null,-1),t("div",{class:"layout-brand-title"},"Plane-Graph",-1)]))}const Ue=x(Te,[["render",Fe],["__scopeId","data-v-85ad154c"]]),qe={class:"layout-actions"},Ze={class:"mf-icon mf-icon-moon"},Je={class:"mf-icon mf-icon-sun"},We=w({__name:"LayoutActions",setup(i){const e=L(!1),a={onTheme(c){const n=c.clientX,o=c.clientY,p=Math.hypot(Math.max(n,innerWidth-n),Math.max(o,innerHeight-o));e.value=!e.value,document.startViewTransition(()=>{const $=document.documentElement;$.classList.remove(e.value?"dark":"light"),$.classList.add(e.value?"light":"dark"),document.body.setAttribute("arco-theme",e.value?"dark":"light")}).ready.then(()=>{const $=[`circle(0px at ${n}px ${o}px)`,`circle(${p}px at ${n}px ${o}px)`];document.documentElement.animate({clipPath:e.value?[...$].reverse():[...$]},{duration:500,easing:"ease-in",pseudoElement:e.value?"::view-transition-old(root)":"::view-transition-new(root)"})})},onGithub(){window.open("https://github.com/fengtianxi001","_blank")}};return(c,n)=>(y(),C("div",qe,[t("div",{class:"action-item",onClick:n[0]||(n[0]=(...o)=>a.onTheme&&a.onTheme(...o))},[U(t("i",Ze,null,512),[[q,!e.value]]),U(t("i",Je,null,512),[[q,e.value]])]),t("div",{class:"action-item",onClick:n[1]||(n[1]=(...o)=>a.onGithub&&a.onGithub(...o))},n[2]||(n[2]=[t("i",{class:"mf-icon mf-icon-github"},null,-1)]))]))}}),He=x(We,[["__scopeId","data-v-4a22c02c"]]),Ke={class:"layout"},Xe={class:"layout-header"},Ye={style:{display:"flex"}},Qe={style:{display:"flex"}},et={class:"layout-body"},tt=w({__name:"Layout",setup(i){return(e,a)=>(y(),C("div",Ke,[t("div",Xe,[t("div",Ye,[f(Ue)]),t("div",Qe,[f(He)])]),t("div",et,[P(e.$slots,"default")])]))}}),at=w({__name:"App",setup(i){const e=L(null),a=L(null),{deviceSorts:c,scenes:n,currentDevices:o,currentDeviceSort:p,currentScene:r,onSceneChange:$,onExportScenes:R,onImportScenes:A}=we({planeContainer:e,deviceContainer:a});return(B,_)=>(y(),Z(l(tt),null,{default:b(()=>[f(l(H),{title:"房间平面图",tip:"右击图标查看设备详情"},{extra:b(()=>[f(l(N),{type:"primary",size:"small",onClick:l(R)},{default:b(()=>_[2]||(_[2]=[j(" 导出场景 ")])),_:1},8,["onClick"]),f(l(N),{type:"primary",size:"small",onClick:l(A)},{default:b(()=>_[3]||(_[3]=[j(" 导入场景 ")])),_:1},8,["onClick"])]),filter:b(()=>[f(l(W),{modelValue:l(r),"onUpdate:modelValue":_[0]||(_[0]=k=>J(r)?r.value=k:null),options:l(n),type:"button",onChange:l($)},null,8,["modelValue","options","onChange"])]),body:b(()=>[t("div",{class:"plane-container",ref_key:"planeContainer",ref:e},null,512)]),_:1}),f(l(H),{title:"智能设备",tip:"拖拽设备至左侧进行放置"},{filter:b(()=>[f(l(W),{modelValue:l(p),"onUpdate:modelValue":_[1]||(_[1]=k=>J(p)?p.value=k:null),options:l(c),type:"button"},null,8,["modelValue","options"])]),body:b(()=>[t("div",{class:"device-container",ref_key:"deviceContainer",ref:a},[(y(!0),C(re,null,ce(l(o),k=>(y(),Z(l(Be),{"data-code":k.code,data:k},null,8,["data-code","data"]))),256))],512)]),_:1})]),_:1}))}}),nt=x(at,[["__scopeId","data-v-cf6cdff2"]]),ot=async()=>{de(nt).mount("#app")};ot();
